<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ASR STORE | Official Store</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3577F0',    
                        secondary: '#ff497c',
                        shopee: '#EE4D2D', 
                        shopeeDark: '#D03E1F',
                        dark: '#0F0F0F',       
                        graytext: '#52525B',
                        light: '#F4F4F5',
                        border: '#E4E4E7'
                    },
                    fontFamily: {
                        sans: ['"Inter"', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #ffffff; -webkit-tap-highlight-color: transparent; font-size: 14px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* --- CARD STYLE --- */
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border: 1px solid #f1f1f1;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .card-image {
            position: relative;
            aspect-ratio: 1/1; 
            overflow: hidden;
            background-color: #f8f8f8;
        }
        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .product-card:hover .card-image img { transform: scale(1.08); }
        
        .card-info {
            padding: 12px;
            background: white;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* --- CAROUSEL SLIDER STYLE --- */
        .carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            border-radius: 20px;
            aspect-ratio: 2/1; /* Mobile Ratio */
        }
        @media (min-width: 768px) {
            .carousel-container { aspect-ratio: 3/1; } 
        }
        .carousel-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }
        .carousel-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Detail Image Main */
        .detail-image-container {
            height: 380px; width: 100%; display: flex; align-items: center; justify-content: center; background-color: #FAFAFA;
        }
        .detail-image-container img { max-height: 100%; max-width: 100%; object-fit: contain; mix-blend-mode: multiply; }
        
        /* Thumbnail Scroll Fix */
        .thumbnail-scroll-container {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 4px 16px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch; /* Smooth scroll iOS */
        }
        .thumbnail-item {
            flex-shrink: 0; /* Mencegah gambar gepeng */
            width: 64px; 
            height: 64px;
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            overflow: hidden;
            background: white;
            transition: all 0.2s;
        }
        .thumbnail-item.active {
            border-color: #3577F0;
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(53, 119, 240, 0.2);
        }
        .thumbnail-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Kotak Sempurna */
        }

        /* LEGAL DOCUMENTS STYLE */
        .legal-content { font-size: 0.95rem; color: #444; line-height: 1.8; text-align: left; }
        .legal-content h3 { font-weight: 800; font-size: 1.1rem; color: #0F0F0F; margin-top: 2.5rem; margin-bottom: 0.8rem; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #eee; padding-bottom: 8px;}
        .legal-content p { margin-bottom: 1.2rem; }
        .legal-content ul { padding-left: 1.2rem; margin-bottom: 1.5rem; list-style-type: none; }
        .legal-content li { margin-bottom: 0.8rem; position: relative; padding-left: 1.5rem; }
        .legal-content li::before { content: "â€¢"; color: #3577F0; font-weight: bold; position: absolute; left: 0; font-size: 1.2rem; line-height: 1rem; }

        [v-cloak] { display: none; }
    </style>
</head>
<body class="text-dark antialiased bg-white pb-24">

    <div id="app" v-cloak class="min-h-screen relative flex flex-col">

        <nav v-if="['home', 'shop'].includes(currentView)" class="bg-white sticky top-0 z-40 border-b border-border shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07)]">
            
            <div class="bg-gradient-to-r from-shopee to-red-500 text-white text-[10px] font-bold text-center py-2 px-4 overflow-hidden relative">
                <div class="absolute inset-0 bg-white/10 pattern-dots"></div>
                <span class="inline-flex items-center gap-2 animate-pulse relative z-10">
                    <i class="fa-solid fa-truck-fast"></i> GRATIS ONGKIR XTRA & BISA COD SELURUH INDONESIA
                </span>
            </div>

            <div class="container mx-auto px-4 h-16 flex items-center justify-between">
                <div class="flex items-center gap-2 cursor-pointer" @click="changeView('home')">
                    <img :src="settings.logo || 'logo.png'" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'" class="h-10 md:h-12 w-auto object-contain">
                    <span class="font-black text-xl tracking-tighter hidden">ASR STORE</span> 
                </div>
                <div class="flex items-center gap-5">
                    <button @click="changeView('shop')" class="text-dark hover:text-primary transition"><i class="fa-solid fa-magnifying-glass text-xl"></i></button>
                    <button @click="toggleCart" class="relative group">
                        <i class="fa-solid fa-bag-shopping text-2xl text-dark group-hover:text-primary transition"></i>
                        <span v-if="cartCount > 0" class="absolute -top-1 -right-1 bg-secondary text-white text-[10px] font-bold w-4 h-4 rounded-full flex items-center justify-center border-2 border-white shadow-sm">{{ cartCount }}</span>
                    </button>
                </div>
            </div>
        </nav>

        <div v-if="['about', 'faq', 'terms', 'privacy', 'contact'].includes(currentView)" class="sticky top-0 bg-white border-b border-border px-4 py-3 flex items-center justify-between h-14 z-30 shadow-sm">
            <button @click="currentView = 'menu'" class="w-10 h-10 flex items-center justify-start text-dark hover:text-primary transition z-10"><i class="fa-solid fa-arrow-left text-xl"></i></button>
            <span class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 font-bold text-sm uppercase tracking-widest text-dark">{{ getPageTitle(currentView) }}</span>
            <div class="w-10"></div>
        </div>

        <main class="flex-grow">
            
            <div v-if="currentView === 'home'" class="animate-fade-in">
                <div class="container mx-auto px-4 py-6">
                    
                    <div v-if="finalBanners.length > 0" class="carousel-container shadow-2xl mb-8 group cursor-pointer">
                        <div class="carousel-track" :style="{ transform: `translateX(-${currentSlide * 100}%)` }">
                            <div v-for="(banner, idx) in finalBanners" :key="idx" class="carousel-slide bg-gray-100 flex items-center justify-center relative">
                                <img :src="banner.image" class="brightness-75">
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-white text-center p-6 z-10">
                                    <h2 v-if="banner.title" class="text-2xl md:text-4xl font-black mb-2 drop-shadow-lg uppercase tracking-tight">{{ banner.title }}</h2>
                                    <p v-if="banner.subtitle" class="text-xs md:text-sm font-bold bg-white/20 backdrop-blur px-4 py-1 rounded-full border border-white/30 mb-2">{{ banner.subtitle }}</p>
                                    <button v-if="banner.btnText" @click="handleBannerClick(banner.link)" class="bg-white text-dark px-6 py-2 rounded-full font-bold text-xs mt-2 hover:scale-105 transition shadow-lg">{{ banner.btnText }}</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10">
                            <div v-for="(b, idx) in finalBanners" :key="idx" :class="currentSlide === idx ? 'bg-white w-6' : 'bg-white/50 w-2'" class="h-2 rounded-full transition-all duration-300"></div>
                        </div>
                    </div>
                    
                    <div v-else class="carousel-container shadow-2xl mb-8 bg-gray-200 animate-pulse flex items-center justify-center rounded-2xl">
                        <span class="text-gray-400 font-bold">Loading Promo...</span>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-8">
                        <div class="bg-orange-50 border border-orange-100 p-3 rounded-xl flex flex-col items-center justify-center text-center">
                            <i class="fa-solid fa-truck-fast text-shopee text-lg mb-1"></i>
                            <span class="text-[9px] font-bold text-dark">Gratis Ongkir</span>
                        </div>
                        <div class="bg-blue-50 border border-blue-100 p-3 rounded-xl flex flex-col items-center justify-center text-center">
                            <i class="fa-solid fa-shield-halved text-primary text-lg mb-1"></i>
                            <span class="text-[9px] font-bold text-dark">100% Ori</span>
                        </div>
                        <div class="bg-green-50 border border-green-100 p-3 rounded-xl flex flex-col items-center justify-center text-center">
                            <i class="fa-solid fa-hand-holding-dollar text-green-600 text-lg mb-1"></i>
                            <span class="text-[9px] font-bold text-dark">Bisa COD</span>
                        </div>
                    </div>

                    <div class="mb-8">
                        <div class="flex justify-between items-end mb-4 px-1">
                            <h2 class="font-bold text-lg text-dark tracking-tight">Kategori</h2>
                            <button @click="changeView('shop')" class="text-primary text-xs font-bold hover:underline">Semua</button>
                        </div>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                            <div v-for="(cat, i) in categories" :key="i" @click="filterByCategory(cat)" 
                                 class="flex-shrink-0 bg-white border border-border px-5 py-2.5 rounded-full cursor-pointer hover:bg-dark hover:text-white hover:border-dark transition shadow-sm">
                                <span class="text-xs font-bold whitespace-nowrap">{{ cat }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h2 class="font-bold text-lg text-dark mb-4 px-1 flex items-center gap-2">
                            <i class="fa-solid fa-fire text-shopee"></i> Terbaru
                        </h2>
                        
                        <div v-if="loading" class="grid grid-cols-2 gap-3"><div v-for="n in 4" class="bg-gray-100 aspect-[3/4] rounded-xl animate-pulse"></div></div>
                        <div v-else class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <div v-for="product in filteredProducts.slice(0, 8)" :key="product.id" @click="viewProduct(product)"
                                 class="product-card group cursor-pointer">
                                
                                <div class="card-image">
                                    <img :src="product.image" alt="Product">
                                    <div class="absolute top-2 left-2 flex flex-col gap-1 z-10">
                                        <div v-if="product.discount > 0" class="bg-secondary text-white text-[9px] font-black px-1.5 py-0.5 rounded shadow-sm">-{{ product.discount }}%</div>
                                    </div>
                                    <div v-if="product.shopeeLink" class="absolute top-2 right-2 z-20">
                                        <div class="bg-shopee text-white w-6 h-6 rounded-full flex items-center justify-center shadow-md">
                                            <i class="fa-solid fa-bag-shopping text-[10px]"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-info">
                                    <div>
                                        <span class="text-[9px] text-gray-400 uppercase tracking-wider block mb-1 truncate">{{ product.category }}</span>
                                        <h3 class="font-bold text-dark text-xs leading-snug line-clamp-2 mb-2 h-8">{{ product.name }}</h3>
                                    </div>
                                    <div class="flex items-center justify-between mt-1">
                                        <div class="flex flex-col">
                                            <span class="text-primary font-black text-sm">Rp {{ format(product.price) }}</span>
                                            <span v-if="product.discount > 0" class="text-gray-400 text-[9px] line-through">{{ format(product.originalPrice) }}</span>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'shop'" class="container mx-auto px-4 py-4 pb-24">
                <div class="sticky top-14 bg-white z-30 py-2 mb-4 border-b border-transparent shadow-sm">
                    <div class="relative">
                        <input v-model="searchQuery" placeholder="Cari produk..." class="w-full bg-light border-none rounded-xl px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-primary/20 pl-10 transition-all font-medium">
                        <i class="fa-solid fa-magnifying-glass absolute left-3.5 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div v-if="!loading && filteredProducts.length === 0" class="text-center py-20">
                    <i class="fa-solid fa-magnifying-glass text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-400 font-bold text-sm">Produk tidak ditemukan.</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <div v-for="product in filteredProducts" :key="product.id" @click="viewProduct(product)" class="product-card group cursor-pointer">
                        <div class="card-image">
                            <img :src="product.image">
                            <div v-if="product.shopeeLink" class="absolute top-2 right-2 bg-shopee text-white w-6 h-6 flex items-center justify-center rounded-full z-10 shadow-sm"><i class="fa-solid fa-bag-shopping text-[9px]"></i></div>
                        </div>
                        <div class="card-info">
                            <h3 class="font-bold text-dark text-xs leading-snug line-clamp-2 mb-1">{{ product.name }}</h3>
                            <span class="text-primary font-black text-sm">Rp {{ format(product.price) }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'menu'" class="container mx-auto px-4 py-8">
                <div class="bg-dark rounded-3xl p-8 text-white mb-8 shadow-2xl relative overflow-hidden">
                    <div class="relative z-10 flex flex-col items-center text-center">
                        <div class="w-20 h-20 bg-white rounded-2xl flex items-center justify-center mb-4 shadow-lg p-2">
                            <img :src="settings.logo || 'logo.png'" onerror="this.style.display='none'; this.parentNode.innerHTML='<span class=\'text-dark font-bold text-3xl\'>A</span>'" class="w-full h-full object-contain">
                        </div>
                        <h2 class="font-black text-2xl tracking-tight mb-1">ASR STORE</h2>
                        <p class="text-sm text-gray-400 font-medium"><i class="fa-solid fa-check-circle text-blue-500"></i> Official Verified Merchant</p>
                    </div>
                    <div class="absolute -bottom-10 -right-10 w-48 h-48 bg-white/5 rounded-full blur-3xl"></div>
                    <div class="absolute -top-10 -left-10 w-48 h-48 bg-primary/20 rounded-full blur-3xl"></div>
                </div>
                
                <div class="space-y-3 max-w-lg mx-auto">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-2 mb-2">Informasi Toko</div>
                    <button @click="changeView('about')" class="w-full bg-white border border-border rounded-xl p-4 flex items-center justify-between hover:bg-light transition group shadow-sm">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-blue-50 text-primary flex items-center justify-center"><i class="fa-solid fa-store text-sm"></i></div><span class="font-bold text-sm text-dark">Tentang Kami</span></div><i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                    </button>
                    <button @click="changeView('faq')" class="w-full bg-white border border-border rounded-xl p-4 flex items-center justify-between hover:bg-light transition group shadow-sm">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center"><i class="fa-solid fa-circle-question text-sm"></i></div><span class="font-bold text-sm text-dark">FAQ</span></div><i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                    </button>
                    <button @click="changeView('terms')" class="w-full bg-white border border-border rounded-xl p-4 flex items-center justify-between hover:bg-light transition group shadow-sm">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center"><i class="fa-solid fa-file-contract text-sm"></i></div><span class="font-bold text-sm text-dark">Syarat & Ketentuan</span></div><i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                    </button>
                    <button @click="changeView('privacy')" class="w-full bg-white border border-border rounded-xl p-4 flex items-center justify-between hover:bg-light transition group shadow-sm">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center"><i class="fa-solid fa-shield-halved text-sm"></i></div><span class="font-bold text-sm text-dark">Kebijakan Privasi</span></div><i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                    </button>

                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest px-2 mt-6 mb-2">Bantuan</div>
                    <button @click="changeView('contact')" class="w-full bg-white border border-border rounded-xl p-4 flex items-center justify-between hover:bg-light transition group shadow-sm">
                        <div class="flex items-center gap-4"><div class="w-8 h-8 rounded-full bg-green-50 text-green-500 flex items-center justify-center"><i class="fa-brands fa-whatsapp text-sm"></i></div><span class="font-bold text-sm text-dark">Hubungi Admin</span></div><i class="fa-solid fa-chevron-right text-xs text-gray-300"></i>
                    </button>
                </div>
                <div class="mt-12 text-center pb-8"><p class="text-[10px] text-gray-300 mt-2">&copy; 2026 ASR STORE. All Rights Reserved.</p></div>
            </div>

            <div v-if="currentView === 'product' && selectedProduct" class="fixed inset-0 bg-white z-[60] flex flex-col animate-fade-in">
                
                <div class="relative bg-white border-b border-border px-4 py-3 flex items-center justify-between flex-shrink-0 h-16 z-30">
                    <button @click="currentView = 'shop'" class="w-10 h-10 flex items-center justify-start text-dark hover:text-primary transition z-10"><i class="fa-solid fa-arrow-left text-xl"></i></button>
                    <span class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 font-bold text-sm uppercase tracking-widest text-dark">Detail Produk</span>
                    <button @click="toggleCart" class="relative w-10 h-10 flex items-center justify-end z-10">
                        <i class="fa-solid fa-bag-shopping text-xl"></i>
                        <span v-if="cartCount > 0" class="absolute top-1 right-0 bg-secondary text-white text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center border border-white">{{ cartCount }}</span>
                    </button>
                </div>

                <div class="flex-grow overflow-y-auto bg-white">
                    <div class="container mx-auto max-w-3xl pb-32"> 
                        <div class="bg-[#FAFAFA] pb-8 pt-4 rounded-b-[2rem] shadow-inner mb-6 relative">
                            <div v-if="selectedProduct.discount > 0" class="absolute top-4 left-4 z-20 bg-secondary text-white font-black px-3 py-1.5 rounded-lg shadow-lg text-xs animate-bounce">
                                HEMAT {{ selectedProduct.discount }}%
                             </div>
                            
                            <div class="detail-image-container">
                                <img :src="activeImage" class="animate-fade-in">
                            </div>

                            <div v-if="selectedProduct.images.length > 1" class="thumbnail-scroll-container mt-6 no-scrollbar">
                                <div v-for="img in selectedProduct.images" :key="img" @click="activeImage = img"
                                     class="thumbnail-item" :class="{ 'active': activeImage === img }">
                                    <img :src="img">
                                </div>
                            </div>
                        </div>

                        <div class="px-6">
                            <div class="border-b border-border pb-6 mb-6">
                                <h1 class="text-2xl font-black text-dark mb-3 leading-snug">{{ selectedProduct.name }}</h1>
                                <div class="flex justify-between items-end">
                                    <div>
                                        <div class="text-3xl font-black text-primary transition-all duration-300">Rp {{ format(dynamicPrice) }}</div>
                                        
                                        <div v-if="selectedProduct.discount > 0 || dynamicPrice < originalDynamicPrice" class="text-gray-400 text-sm line-through mt-1">
                                            Rp {{ format(originalDynamicPrice) }}
                                        </div>
                                    </div>
                                    <div class="flex flex-col items-end gap-1">
                                        <div class="bg-dark text-white px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wide">
                                            Stok: {{ selectedProduct.stok }}
                                        </div>
                                        <div class="text-[10px] text-gray-500 font-medium"><i class="fa-solid fa-star text-yellow-400"></i> 4.9 (Terjual 100+)</div>
                                    </div>
                                </div>
                            </div>

                            <a v-if="selectedProduct.shopeeLink" :href="selectedProduct.shopeeLink" target="_blank" 
                               class="block w-full bg-gradient-to-r from-shopee to-orange-400 text-white rounded-2xl p-4 mb-6 shadow-lg shadow-orange-500/30 hover:shadow-orange-500/50 transform hover:scale-[1.02] transition relative overflow-hidden group">
                                <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition"><i class="fa-solid fa-bag-shopping text-6xl"></i></div>
                                <div class="flex items-center gap-4 relative z-10">
                                    <div class="w-12 h-12 bg-white text-shopee rounded-full flex items-center justify-center text-xl shadow-md animate-pulse-slow">
                                        <i class="fa-solid fa-bolt"></i>
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold uppercase tracking-widest text-white/90 mb-0.5">Shopee Official</div>
                                        <div class="font-black text-lg leading-tight">Checkout via Shopee</div>
                                        <div class="text-xs text-white/90 font-medium"><i class="fa-solid fa-ticket"></i> Voucher Gratis Ongkir Tersedia</div>
                                    </div>
                                    <div class="ml-auto">
                                        <div class="bg-white/20 backdrop-blur px-3 py-1.5 rounded-lg text-xs font-bold">Beli <i class="fa-solid fa-arrow-right ml-1"></i></div>
                                    </div>
                                </div>
                            </a>

                            <div class="space-y-6 mb-8">
                                <div v-if="selectedProduct.colors.length">
                                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest block mb-3">Pilih Warna</span>
                                    <div class="flex flex-wrap gap-3">
                                        <button v-for="c in selectedProduct.colors" @click="detailForm.color = c" :class="detailForm.color === c ? 'bg-dark text-white border-dark ring-2 ring-offset-2 ring-gray-200 shadow-md' : 'bg-white text-gray-600 border-border hover:border-gray-400'" class="px-5 py-2.5 rounded-xl text-sm font-bold border transition min-w-[4rem]">{{ c }}</button>
                                    </div>
                                </div>
                                <div v-if="selectedProduct.sizes.length">
                                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest block mb-3">Pilih Ukuran</span>
                                    <div class="flex flex-wrap gap-3">
                                        <button v-for="s in selectedProduct.sizes" @click="detailForm.size = s" :class="detailForm.size === s ? 'bg-primary text-white border-primary ring-2 ring-offset-2 ring-blue-100 shadow-md transform scale-105' : 'bg-white text-gray-600 border-border hover:border-gray-400'" class="w-12 h-12 rounded-xl flex items-center justify-center text-sm font-bold border transition">{{ s }}</button>
                                    </div>
                                    <p class="text-[10px] text-gray-400 mt-2 italic">*Harga mungkin berbeda untuk setiap ukuran.</p>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-2xl p-6 border border-border mb-8">
                                <h3 class="font-bold text-sm mb-3 text-dark uppercase tracking-widest flex items-center gap-2"><i class="fa-solid fa-align-left text-primary"></i> Deskripsi Produk</h3>
                                <p class="text-sm text-gray-600 leading-relaxed whitespace-pre-line text-justify">{{ selectedProduct.description }}</p>
                            </div>

                            <div v-if="relatedProducts.length > 0" class="mb-8">
                                <h3 class="font-bold text-lg text-dark mb-4 flex items-center gap-2">
                                    <i class="fa-solid fa-thumbs-up text-primary"></i> Produk Serupa
                                </h3>
                                <div class="grid grid-cols-2 gap-3">
                                    <div v-for="rp in relatedProducts" :key="rp.id" @click="viewProduct(rp)" class="bg-white border border-border rounded-xl p-2 cursor-pointer hover:shadow-lg transition flex gap-3 items-center group">
                                        <img :src="rp.image" class="w-14 h-14 rounded-lg object-cover bg-gray-100 group-hover:scale-105 transition">
                                        <div class="flex-1 min-w-0">
                                            <h4 class="font-bold text-xs truncate text-dark">{{ rp.name }}</h4>
                                            <span class="text-xs text-primary font-bold">Rp {{ format(rp.price) }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="border-t border-border p-4 bg-white fixed bottom-0 left-0 w-full z-50 md:static md:border-0 md:p-0 shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
                    <div class="container mx-auto max-w-3xl flex flex-col gap-3">
                        <div class="flex gap-3">
                            <div class="flex items-center border border-border rounded-2xl h-12 md:h-14 bg-white w-28 px-1 flex-shrink-0">
                                <button @click="detailForm.qty > 1 ? detailForm.qty-- : null" class="w-8 h-full flex items-center justify-center text-gray-500 hover:bg-gray-50 rounded-l-xl transition"><i class="fa-solid fa-minus text-xs"></i></button>
                                <input readonly v-model="detailForm.qty" class="w-full h-full text-center font-bold text-base bg-transparent outline-none border-x border-transparent text-dark">
                                <button @click="detailForm.qty < selectedProduct.stok ? detailForm.qty++ : null" class="w-8 h-full flex items-center justify-center text-gray-500 hover:bg-gray-50 rounded-r-xl transition"><i class="fa-solid fa-plus text-xs"></i></button>
                            </div>

                            <div class="flex-1 flex gap-2">
                                <a v-if="selectedProduct.shopeeLink" :href="selectedProduct.shopeeLink" target="_blank" 
                                   class="flex-1 bg-shopee hover:bg-shopeeDark text-white rounded-2xl h-12 md:h-14 font-bold text-sm shadow-lg shadow-orange-200 active:scale-95 transition flex flex-col items-center justify-center leading-tight">
                                   <span class="flex items-center gap-1"><i class="fa-solid fa-bag-shopping"></i> Beli Shopee</span>
                                   <span class="text-[9px] font-normal opacity-90">Gratis Ongkir</span>
                                </a>

                                <button @click="addToCartFromDetail" 
                                        :class="selectedProduct.shopeeLink ? 'flex-1' : 'w-full'"
                                        class="bg-dark hover:bg-black text-white rounded-2xl h-12 md:h-14 font-bold text-sm shadow-xl shadow-gray-200 active:scale-95 transition flex items-center justify-center gap-2">
                                    <span class="text-sm">Manual Order</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'contact'" class="container mx-auto px-4 py-6">
                 <div class="bg-white border border-border rounded-3xl p-8 shadow-xl text-center mb-8">
                    <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl shadow-inner"><i class="fa-brands fa-whatsapp"></i></div>
                    <h2 class="font-black text-2xl text-dark mb-2">Layanan Pelanggan</h2>
                    <p class="text-sm text-gray-500 mb-8 px-4 leading-relaxed">Tim admin kami online Senin - Sabtu (09.00 - 17.00 WIB). Klik tombol di bawah untuk konsultasi produk.</p>
                    <a href="https://wa.me/6285892767032" class="block w-full bg-green-600 text-white py-4 rounded-xl font-bold text-sm shadow-xl shadow-green-600/30 hover:bg-green-700 transition transform active:scale-95 flex items-center justify-center gap-2">
                        <i class="fa-regular fa-comment-dots text-lg"></i> Chat Admin Sekarang
                    </a>
                </div>
            </div>

            <div v-if="currentView === 'about'" class="container mx-auto px-4 py-6 max-w-2xl animate-fade-in">
                <div class="legal-content">
                    <h2 class="text-3xl font-black mb-6 border-b pb-4">Tentang ASR STORE</h2>
                    <p>Selamat datang di <strong>ASR STORE</strong>, partner gaya hidup dan teknologi terpercaya Anda di Indonesia. Kami bukan sekadar toko online, kami adalah kurator produk berkualitas yang berkomitmen menghadirkan pengalaman belanja modern, aman, dan memuaskan.</p>
                    <p>Didirikan dengan semangat inovasi, ASR STORE fokus pada kategori Fashion, Gadget, dan Aksesoris Pria yang telah melalui proses seleksi ketat (Quality Control) sebelum sampai ke tangan Anda.</p>
                    
                    <h3><i class="fa-solid fa-bullseye text-primary"></i> Visi & Misi Kami</h3>
                    <p><strong>Visi:</strong> Menjadi platform e-commerce dan affiliate terdepan yang paling dipercaya di Indonesia, menghubungkan pelanggan dengan produk original tanpa rasa khawatir.</p>
                    <p><strong>Misi:</strong></p>
                    <ul>
                        <li>Menyediakan produk 100% Original dan bergaransi.</li>
                        <li>Memberikan layanan pelanggan yang responsif dan solutif.</li>
                        <li>Mendukung sistem pembayaran fleksibel termasuk COD (Bayar di Tempat).</li>
                    </ul>

                    <h3><i class="fa-solid fa-handshake text-primary"></i> Kenapa Harus ASR STORE?</h3>
                    <ul>
                        <li><strong>Official Affiliate Partner:</strong> Kami bekerja sama resmi dengan marketplace besar (Shopee) untuk menjamin stok dan promo terbaik.</li>
                        <li><strong>Keamanan Data:</strong> Privasi Anda adalah prioritas mutlak kami.</li>
                        <li><strong>Pengiriman Cepat:</strong> Didukung oleh mitra logistik terpercaya (JNE, J&T, SiCepat, Anteraja).</li>
                    </ul>
                </div>
            </div>

            <div v-if="currentView === 'faq'" class="container mx-auto px-4 py-6 animate-fade-in">
                <div class="text-center mb-8"><h2 class="text-2xl font-black">Pertanyaan Umum (FAQ)</h2></div>
                <div class="space-y-4">
                    <div v-for="(item, index) in faqItems" :key="index" class="bg-white border border-border rounded-xl overflow-hidden shadow-sm">
                        <button @click="item.open = !item.open" class="w-full flex items-center justify-between p-4 text-left font-bold text-sm text-dark hover:bg-light transition">
                            {{ item.q }} <i :class="item.open ? 'fa-minus' : 'fa-plus'" class="fa-solid text-xs text-primary"></i>
                        </button>
                        <div v-if="item.open" class="p-4 pt-0 text-sm text-gray-600 bg-light leading-relaxed border-t border-border text-justify">
                            {{ item.a }}
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'terms'" class="container mx-auto px-4 py-6 max-w-2xl animate-fade-in">
                <div class="legal-content">
                    <h2 class="text-3xl font-black mb-6 border-b pb-4">Syarat & Ketentuan</h2>
                    <p>Dengan mengakses atau berbelanja di ASR STORE, Anda dianggap telah menyetujui syarat dan ketentuan berikut:</p>
                    
                    <h3>1. Pemesanan & Pembayaran</h3>
                    <ul>
                        <li>Harga yang tertera di website adalah harga final dan dapat berubah sewaktu-waktu tanpa pemberitahuan.</li>
                        <li>Pembayaran manual via WhatsApp harus diselesaikan dalam waktu 1x24 jam setelah konfirmasi admin.</li>
                        <li>Untuk produk dengan link Shopee, segala transaksi tunduk pada Syarat & Ketentuan Shopee sepenuhnya.</li>
                    </ul>

                    <h3>2. Pengiriman & Risiko</h3>
                    <ul>
                        <li>Pesanan akan diproses pada hari kerja (Senin - Sabtu). Pesanan hari Minggu dikirim Senin.</li>
                        <li>Resi pengiriman akan diinformasikan maksimal H+1 setelah barang dikirim.</li>
                        <li>ASR STORE tidak bertanggung jawab atas keterlambatan yang disebabkan oleh pihak kurir (pihak ketiga).</li>
                    </ul>

                    <h3>3. Kebijakan Retur (Pengembalian)</h3>
                    <ul>
                        <li>Wajib menyertakan <strong>VIDEO UNBOXING</strong> tanpa jeda/edit saat membuka paket. Tanpa video, komplain tidak dilayani.</li>
                        <li>Retur hanya berlaku untuk cacat produksi atau kesalahan pengiriman (salah warna/size).</li>
                        <li>Maksimal klaim 2x24 jam setelah status resi "Diterima".</li>
                    </ul>
                </div>
            </div>

            <div v-if="currentView === 'privacy'" class="container mx-auto px-4 py-6 max-w-2xl animate-fade-in">
                <div class="legal-content">
                    <h2 class="text-3xl font-black mb-6 border-b pb-4">Kebijakan Privasi</h2>
                    <p>Kami sangat menghargai kepercayaan Anda. Berikut adalah cara kami mengelola data pribadi Anda:</p>
                    
                    <h3>Pengumpulan Data</h3>
                    <p>Kami hanya mengumpulkan informasi yang diperlukan untuk memproses pesanan Anda, meliputi:</p>
                    <ul>
                        <li>Nama Lengkap (untuk tujuan pengiriman).</li>
                        <li>Alamat Lengkap & Koordinat lokasi.</li>
                        <li>Nomor Telepon/WhatsApp (untuk konfirmasi).</li>
                    </ul>

                    <h3>Penggunaan Data</h3>
                    <p>Data Anda hanya digunakan internal untuk:</p>
                    <ul>
                        <li>Memproses dan mengirim pesanan.</li>
                        <li>Menghubungi Anda terkait status pesanan.</li>
                        <li>Keperluan administrasi internal ASR STORE.</li>
                    </ul>
                    <p><strong>Kami TIDAK AKAN PERNAH menjual atau membagikan data Anda kepada pihak lain untuk tujuan pemasaran tanpa izin Anda.</strong></p>

                    <h3>Keamanan</h3>
                    <p>Website ini menggunakan teknologi enkripsi standar industri untuk melindungi pertukaran data. Transaksi via WhatsApp juga dijamin kerahasiaannya oleh enkripsi End-to-End WhatsApp.</p>
                </div>
            </div>

        </main>

        <div class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-border flex justify-around items-center py-2 z-30 pb-safe shadow-[0_-4px_20px_rgba(0,0,0,0.03)]" v-if="currentView !== 'product'">
            <button @click="changeView('home')" :class="currentView === 'home' ? 'text-primary' : 'text-gray-400'" class="flex flex-col items-center p-1 w-16 transition"><i class="fa-solid fa-house text-lg mb-1"></i><span class="text-[9px] font-bold">Beranda</span></button>
            <button @click="changeView('shop')" :class="currentView === 'shop' ? 'text-primary' : 'text-gray-400'" class="flex flex-col items-center p-1 w-16 transition"><i class="fa-solid fa-bag-shopping text-lg mb-1"></i><span class="text-[9px] font-bold">Produk</span></button>
            <button @click="toggleCart" class="flex flex-col items-center p-1 w-16 text-gray-400 relative transition"><div class="relative"><i class="fa-solid fa-cart-shopping text-lg mb-1"></i><span v-if="cartCount > 0" class="absolute -top-1.5 -right-1.5 bg-secondary text-white text-[8px] font-bold w-3.5 h-3.5 rounded-full flex items-center justify-center border border-white">{{ cartCount }}</span></div><span class="text-[9px] font-bold">Keranjang</span></button>
            <button @click="changeView('menu')" :class="['menu','about','faq','terms','privacy','contact'].includes(currentView) ? 'text-primary' : 'text-gray-400'" class="flex flex-col items-center p-1 w-16 transition"><i class="fa-solid fa-bars text-lg mb-1"></i><span class="text-[9px] font-bold">Menu</span></button>
        </div>

        <div v-if="isCartOpen" class="fixed inset-0 z-[100] flex justify-end">
            <div class="absolute inset-0 bg-dark/60 backdrop-blur-sm transition-opacity" @click="toggleCart"></div>
            <div class="relative w-full max-w-sm bg-white h-full shadow-2xl flex flex-col transform transition-transform duration-300 animate-fade-in">
                <div class="p-6 border-b border-border flex justify-between items-center bg-white"><h2 class="font-bold text-lg text-dark tracking-tight">Keranjang Belanja</h2><button @click="toggleCart" class="text-gray-400 hover:text-dark transition"><i class="fa-solid fa-xmark text-xl"></i></button></div>
                <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-light">
                    <div v-if="cart.length === 0" class="flex flex-col items-center justify-center h-64 text-gray-400"><i class="fa-solid fa-basket-shopping text-5xl mb-4 opacity-20"></i><p class="text-sm font-bold">Keranjang Anda kosong</p></div>
                    <div v-for="(item, idx) in cart" :key="idx" class="bg-white p-4 rounded-2xl flex gap-4 shadow-sm border border-transparent hover:border-border transition">
                        <div class="w-20 h-20 bg-light rounded-xl flex-shrink-0"><img :src="item.image" class="w-full h-full object-contain mix-blend-multiply"></div>
                        <div class="flex-1 min-w-0 flex flex-col justify-between">
                            <div><h4 class="font-bold text-sm truncate text-dark mb-1">{{ item.name }}</h4><p class="text-[10px] text-gray-500 bg-light inline-block px-2 py-0.5 rounded border border-border">{{ item.color }} / {{ item.size }}</p></div>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-primary font-bold text-sm">Rp {{ format(item.price * item.qty) }}</span>
                                <div class="flex items-center bg-light rounded-lg h-7 border border-border"><button @click="item.qty > 1 ? item.qty-- : removeFromCart(idx)" class="w-7 font-bold text-xs text-gray-500 hover:text-dark">-</button><span class="text-xs font-bold w-6 text-center text-dark">{{ item.qty }}</span><button @click="item.qty++" class="w-7 font-bold text-xs text-gray-500 hover:text-dark">+</button></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="p-6 bg-white border-t border-border shadow-[0_-5px_30px_rgba(0,0,0,0.05)]">
                    <div class="flex justify-between mb-6"><span class="text-sm font-bold text-gray-500">Total Tagihan</span><span class="text-xl font-black text-primary">Rp {{ format(cartTotal) }}</span></div>
                    <div class="space-y-4">
                        <input v-model="customer.name" placeholder="Nama Penerima" class="w-full bg-light border-2 border-transparent rounded-2xl px-5 py-3.5 text-sm outline-none focus:border-dark transition font-medium">
                        <textarea v-model="customer.address" placeholder="Alamat Lengkap Pengiriman" class="w-full bg-light border-2 border-transparent rounded-2xl px-5 py-3.5 text-sm outline-none h-24 resize-none focus:border-dark transition font-medium"></textarea>
                        <button @click="processCheckout" :disabled="isProcessing || !customer.name || !customer.address" class="w-full bg-dark text-white py-4 rounded-2xl font-bold text-sm shadow-xl hover:bg-black disabled:bg-gray-300 disabled:shadow-none transition flex items-center justify-center gap-2">
                            <span v-if="isProcessing"><i class="fa-solid fa-circle-notch fa-spin"></i> Memproses...</span>
                            <span v-else><i class="fa-brands fa-whatsapp text-lg"></i> Checkout via WhatsApp</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="toast.show" class="fixed top-24 left-1/2 -translate-x-1/2 bg-dark/95 backdrop-blur-md text-white px-6 py-4 rounded-2xl shadow-2xl z-[200] text-sm font-bold animate-bounce flex items-center gap-3 min-w-[200px] justify-center border border-white/10">
            <i class="fa-solid fa-circle-check text-green-400 text-lg"></i> {{ toast.message }}
        </div>
    </div>

    <script type="module">
        import { createApp, ref, computed, onMounted, reactive, watch } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.prod.js';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, onSnapshot, query, orderBy, getDoc, doc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = { apiKey: "AIzaSyC131UjEYgOY4MFOOgPXdTSm07TpGWFraE", authDomain: "asr-id.firebaseapp.com", projectId: "asr-id", storageBucket: "asr-id.firebasestorage.app", messagingSenderId: "327137445466", appId: "1:327137445466:web:54a191beedbb06b1fa7a63" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        createApp({
            setup() {
                const currentView = ref('home');
                const loading = ref(true);
                const isCartOpen = ref(false);
                const isProcessing = ref(false);
                const products = ref([]);
                const cart = ref([]);
                const searchQuery = ref('');
                const selectedCategory = ref('');
                const selectedProduct = ref(null);
                const activeImage = ref('');
                const detailForm = reactive({ qty: 1, color: '', size: '' });
                const customer = reactive({ name: '', address: '' });
                const toast = reactive({ show: false, message: '' });
                
                // SETTINGS & BANNERS UPDATED
                const settings = reactive({ logo: '', banners: [] });
                
                // SLIDER STATE
                const currentSlide = ref(0);
                let slideInterval;

                // FAQ CONTENT
                const faqItems = reactive([
                    { q: "Apakah produk dijamin original?", a: "Ya, 100% produk yang kami jual adalah original karena kami mengambil langsung dari distributor resmi dan produsen terpercaya. Kami memberikan garansi uang kembali jika produk terbukti palsu.", open: false },
                    { q: "Bagaimana cara klaim garansi?", a: "Jika barang diterima dalam keadaan rusak atau cacat, harap sertakan VIDEO UNBOXING tanpa jeda mulai dari paket utuh hingga terlihat kerusakannya. Hubungi admin kami melalui WhatsApp maksimal 2x24 jam setelah barang diterima.", open: false },
                    { q: "Apakah bisa bayar di tempat (COD)?", a: "Untuk pembelian manual via WhatsApp, saat ini kami mengutamakan transfer bank. Namun jika Anda ingin layanan COD, silakan klik tombol 'Beli di Shopee' yang tersedia di setiap halaman produk untuk melakukan transaksi via Marketplace dengan fitur COD.", open: false },
                    { q: "Berapa lama pengiriman barang?", a: "Pengiriman reguler memakan waktu 2-4 hari kerja untuk area Jawa dan 4-7 hari kerja untuk luar Jawa. Kami menggunakan ekspedisi terpercaya seperti JNE, J&T, dan SiCepat. Resi akan dikirim H+1.", open: false },
                    { q: "Apakah bisa tukar ukuran (Size)?", a: "Penukaran ukuran diperbolehkan maksimal 1 hari setelah barang sampai, dengan syarat label tag masih utuh dan ongkir bolak-balik ditanggung pembeli sepenuhnya.", open: false },
                ]);

                const latestProduct = computed(() => products.value[0]);
                const categories = computed(() => [...new Set(products.value.map(p=>p.category))]);
                const cartCount = computed(() => cart.value.reduce((a,b)=>a+b.qty,0));
                const cartTotal = computed(() => cart.value.reduce((a,b)=>a+(b.price*b.qty),0));
                const format = (v) => new Intl.NumberFormat('id-ID').format(v);
                const getPageTitle = (view) => ({ 'about': 'Tentang Kami', 'faq': 'FAQ', 'terms': 'S&K', 'privacy': 'Privasi', 'contact': 'Hubungi Kami', 'menu': 'Menu' }[view] || 'Info');
                
                // FILTER BANNERS: Only show banners with images
                const finalBanners = computed(() => {
                    return settings.banners ? settings.banners.filter(b => b.image) : [];
                });

                onMounted(() => {
                    const saved = localStorage.getItem('asr_cart');
                    if(saved) cart.value = JSON.parse(saved);
                    fetchProducts();
                    fetchSettings();
                    
                    // START SLIDER
                    slideInterval = setInterval(() => {
                        if(finalBanners.value.length > 0) {
                            currentSlide.value = (currentSlide.value + 1) % finalBanners.value.length;
                        }
                    }, 4000); 
                });
                
                watch(cart, (n) => localStorage.setItem('asr_cart', JSON.stringify(n)), {deep:true});

                const fetchSettings = async () => {
                    try {
                        const docSnap = await getDoc(doc(db, "settings", "global"));
                        if(docSnap.exists()) {
                            const data = docSnap.data();
                            settings.logo = data.logo;
                            // HANDLE NEW OBJECT STRUCTURE FROM ADMIN
                            let bannersData = data.banners || [];
                            
                            // Compatibility check: if old format (string), convert to object
                            settings.banners = bannersData.map(b => {
                                if(typeof b === 'string') return { image: b, title: '', subtitle: '', btnText: '', link: '' };
                                return b;
                            });

                            // Fallback: use old heroImage if banners empty
                            if(settings.banners.length === 0 && data.heroImage) {
                                settings.banners = [{ image: data.heroImage, title: 'ASR STORE', subtitle: 'Official Store', btnText: 'Belanja', link: '' }];
                            }
                        }
                    } catch(e) {}
                };

                const fetchProducts = () => {
                    try {
                        const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
                        onSnapshot(q, (snap) => {
                            if(snap.empty) { 
                                products.value = []; 
                            } else {
                                products.value = snap.docs.map(doc => {
                                    const d = doc.data();
                                    const p = Number(d.price);
                                    const disc = Number(d.discount)||0;
                                    return {
                                        id: doc.id,
                                        name: d.name,
                                        category: d.category||'Umum',
                                        price: p - (p*(disc/100)),
                                        originalPrice: p,
                                        discount: disc,
                                        stok: Number(d.stok),
                                        image: d.image,
                                        images: (d.gallery && d.gallery.length > 0) ? d.gallery : [d.image],
                                        colors: d.colors||[],
                                        sizes: d.sizes||[],
                                        variants: d.variants || [], 
                                        description: d.description||"Deskripsi belum tersedia.",
                                        shopeeLink: d.shopeeLink || null 
                                    };
                                });
                            }
                            loading.value = false;
                        }, (err) => { 
                            console.error("Fetch error:", err);
                            products.value = []; 
                            loading.value = false; 
                        });
                    } catch(e){ 
                        console.error("System error:", e);
                        products.value = []; 
                        loading.value = false; 
                    }
                };

                const dynamicPrice = computed(() => {
                    if (!selectedProduct.value) return 0;
                    if (detailForm.size) {
                        const variants = selectedProduct.value.variants || [];
                        const selectedVariant = variants.find(v => v.name === detailForm.size);
                        if (selectedVariant && selectedVariant.price) {
                            return Number(selectedVariant.price);
                        }
                    }
                    return selectedProduct.value.price;
                });

                const originalDynamicPrice = computed(() => {
                    if (!selectedProduct.value) return 0;
                    if (detailForm.size) {
                        const variants = selectedProduct.value.variants || [];
                        const selectedVariant = variants.find(v => v.name === detailForm.size);
                        if (selectedVariant && selectedVariant.originalPrice) {
                            return Number(selectedVariant.originalPrice);
                        } else if (selectedVariant && selectedVariant.price) {
                            return Number(selectedVariant.price); 
                        }
                    }
                    return selectedProduct.value.originalPrice;
                });

                const filteredProducts = computed(() => {
                    let r = products.value;
                    if(searchQuery.value) r = r.filter(p=>p.name.toLowerCase().includes(searchQuery.value.toLowerCase()));
                    if(selectedCategory.value) r = r.filter(p=>p.category === selectedCategory.value);
                    return r;
                });

                const relatedProducts = computed(() => {
                    if(!selectedProduct.value) return [];
                    return products.value
                        .filter(p => p.category === selectedProduct.value.category && p.id !== selectedProduct.value.id)
                        .slice(0, 4); 
                });

                const viewProduct = (p) => {
                    selectedProduct.value = p;
                    activeImage.value = p.images ? p.images[0] : p.image;
                    detailForm.qty = 1;
                    detailForm.color = p.colors[0]||'';
                    detailForm.size = p.sizes[0]||'';
                    currentView.value = 'product';
                    window.scrollTo(0,0);
                };

                const addToCartFromDetail = () => {
                    const currentPrice = dynamicPrice.value; 
                    const ex = cart.value.find(c=>c.id===selectedProduct.value.id && c.color===detailForm.color && c.size===detailForm.size);
                    if(ex) {
                        ex.qty+=detailForm.qty; 
                    } else {
                        cart.value.push({
                            ...selectedProduct.value, 
                            ...detailForm,
                            price: currentPrice 
                        });
                    }
                    showToast('Produk masuk keranjang!');
                    isCartOpen.value = true;
                };

                const processCheckout = () => {
                    isProcessing.value = true;
                    setTimeout(() => {
                        let msg = `Halo Admin ASR STORE, saya ingin order:%0A%0AðŸ‘¤ *Nama:* ${customer.name}%0AðŸ“ *Alamat:* ${customer.address}%0A%0AðŸ›’ *Order:*%0A`;
                        cart.value.forEach((x,i)=> {
                            msg+=`${i+1}. ${x.name} %0A   â€¢ Varian: ${x.color} ${x.size ? '/ '+x.size : ''}%0A   â€¢ Qty: ${x.qty} x Rp ${format(x.price)}%0A`;
                        });
                        msg+=`%0AðŸ’° *Total Tagihan:* Rp ${format(cartTotal.value)}%0A%0AMohon info rekening pembayarannya.`;
                        window.open(`https://wa.me/6285892767032?text=${msg}`);
                        cart.value=[]; localStorage.removeItem('asr_cart'); isCartOpen.value=false; isProcessing.value=false;
                    }, 1000);
                };

                const handleBannerClick = (link) => {
                    if(link) {
                        if(link.startsWith('http')) window.open(link, '_blank');
                        else changeView('shop');
                    }
                };

                const removeFromCart = (i) => cart.value.splice(i,1);
                const toggleCart = () => isCartOpen.value = !isCartOpen.value;
                const changeView = (v) => { currentView.value = v; window.scrollTo(0,0); };
                const showToast = (m) => { toast.message=m; toast.show=true; setTimeout(()=>toast.show=false, 2000); };
                const filterByCategory = (c) => { selectedCategory.value=c; changeView('shop'); };

                return {
                    currentView, loading, isCartOpen, products, cart, searchQuery, selectedCategory, selectedProduct, activeImage,
                    detailForm, customer, toast, isProcessing, categories, filteredProducts, cartCount, cartTotal, latestProduct, faqItems, settings, relatedProducts,
                    dynamicPrice, originalDynamicPrice, currentSlide, finalBanners,
                    format, viewProduct, addToCartFromDetail, processCheckout, removeFromCart, toggleCart, changeView, filterByCategory, getPageTitle, handleBannerClick
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
